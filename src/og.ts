import { html } from "satori-html"
import { readFile } from "fs/promises"
import satori from "satori"
import { Resvg } from "@resvg/resvg-js"
export const buildHTML = (
	title: string,
	date: Date,
	slug: string,
) => {
	return html`<div style="display: flex;">
<svg width="1200" height="630" viewBox="0 0 1200 630" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1_2)">
<rect width="1200" height="630" fill="#100B1D"/>
<path d="M220.15 333.498C219.987 325.12 214.938 317.476 207.166 313.84C199.394 310.205 190.353 311.258 183.755 316.473L104.806 379.387L7.93097 350.069C-0.172647 347.637 -8.92426 349.883 -14.5931 355.91C-20.262 361.937 -22.045 370.687 -19.0731 378.492L16.9028 473.13L-40.8431 556.076C-45.5827 562.915 -45.9572 571.947 -41.7583 579.269C-37.5595 586.592 -29.5429 591.021 -21.0679 590.684L79.8401 586.191L141.066 666.528C146.239 673.25 154.748 676.627 163.089 675.095C171.429 673.563 178.094 667.548 180.306 659.527L206.901 562.009L302.604 528.969C310.5 526.248 316.137 519.301 317.067 511.057C317.997 502.813 314.175 494.685 307.114 490.024L222.457 434.423L220.15 333.498Z" fill="#8068C5" fill-opacity="0.4"/>
<rect x="1174" y="28" width="5" height="576" rx="2.5" fill="#C1B5E3"/>
<path d="M1026.21 603V585.48H1028.51V595.944H1027.94C1027.94 594.68 1028.1 593.592 1028.42 592.68C1028.75 591.752 1029.26 591.04 1029.95 590.544C1030.64 590.048 1031.52 589.8 1032.59 589.8H1032.69C1034.22 589.8 1035.38 590.312 1036.17 591.336C1036.95 592.344 1037.34 593.792 1037.34 595.68V603H1035.04V595.2C1035.04 594.16 1034.74 593.352 1034.15 592.776C1033.58 592.2 1032.82 591.912 1031.9 591.912C1030.87 591.912 1030.05 592.256 1029.42 592.944C1028.82 593.616 1028.51 594.504 1028.51 595.608V603H1026.21ZM1041.56 603V590.184H1043.38V595.464H1043.29C1043.29 593.592 1043.7 592.224 1044.51 591.36C1045.34 590.48 1046.58 590.04 1048.23 590.04H1048.66V592.104H1047.85C1046.57 592.104 1045.58 592.448 1044.9 593.136C1044.21 593.808 1043.86 594.784 1043.86 596.064V603H1041.56ZM1056.63 603.144C1055.67 603.144 1054.84 603.008 1054.13 602.736C1053.45 602.464 1052.91 602 1052.53 601.344C1052.16 600.672 1051.97 599.768 1051.97 598.632V586.296H1054.18V598.92C1054.18 599.608 1054.37 600.144 1054.73 600.528C1055.12 600.896 1055.65 601.08 1056.34 601.08H1058.6V603.144H1056.63ZM1049.77 591.912V590.184H1058.6V591.912H1049.77ZM1067.67 603.432C1066.55 603.432 1065.56 603.24 1064.71 602.856C1063.87 602.472 1063.15 601.968 1062.55 601.344C1061.98 600.704 1061.54 599.992 1061.23 599.208C1060.95 598.424 1060.8 597.624 1060.8 596.808V596.376C1060.8 595.56 1060.95 594.76 1061.26 593.976C1061.56 593.176 1062.01 592.464 1062.6 591.84C1063.19 591.2 1063.91 590.696 1064.76 590.328C1065.61 589.944 1066.58 589.752 1067.67 589.752C1068.75 589.752 1069.72 589.944 1070.57 590.328C1071.42 590.696 1072.14 591.2 1072.73 591.84C1073.32 592.464 1073.77 593.176 1074.07 593.976C1074.38 594.76 1074.53 595.56 1074.53 596.376V596.808C1074.53 597.624 1074.38 598.424 1074.07 599.208C1073.79 599.992 1073.35 600.704 1072.75 601.344C1072.18 601.968 1071.47 602.472 1070.62 602.856C1069.77 603.24 1068.79 603.432 1067.67 603.432ZM1067.67 601.368C1068.63 601.368 1069.44 601.16 1070.11 600.744C1070.8 600.312 1071.32 599.736 1071.67 599.016C1072.04 598.296 1072.23 597.488 1072.23 596.592C1072.23 595.68 1072.04 594.864 1071.67 594.144C1071.31 593.424 1070.78 592.856 1070.09 592.44C1069.42 592.024 1068.61 591.816 1067.67 591.816C1066.74 591.816 1065.93 592.024 1065.24 592.44C1064.55 592.856 1064.03 593.424 1063.66 594.144C1063.29 594.864 1063.11 595.68 1063.11 596.592C1063.11 597.488 1063.28 598.296 1063.63 599.016C1064 599.736 1064.52 600.312 1065.19 600.744C1065.88 601.16 1066.71 601.368 1067.67 601.368ZM1081.49 603L1084.08 590.616H1087.2L1090.23 603H1088.26L1085.24 590.664H1086L1083.39 603H1081.49ZM1080.32 603V601.176H1082.98V603H1080.32ZM1079.79 603L1076.16 590.184H1078.37L1081.9 603H1079.79ZM1088.74 603V601.176H1091.4V603H1088.74ZM1089.82 603L1092.89 590.184H1094.98L1091.84 603H1089.82ZM1098.71 603V590.184H1101.02V603H1098.71ZM1096.75 592.008V590.184H1101.02V592.008H1096.75ZM1099.36 588.12C1098.85 588.12 1098.47 587.984 1098.21 587.712C1097.97 587.44 1097.85 587.096 1097.85 586.68C1097.85 586.264 1097.97 585.92 1098.21 585.648C1098.47 585.376 1098.85 585.24 1099.36 585.24C1099.87 585.24 1100.25 585.376 1100.49 585.648C1100.75 585.92 1100.87 586.264 1100.87 586.68C1100.87 587.096 1100.75 587.44 1100.49 587.712C1100.25 587.984 1099.87 588.12 1099.36 588.12ZM1106.1 603V590.184H1108.4V603H1106.1ZM1104.13 592.008V590.184H1108.4V592.008H1104.13ZM1106.75 588.12C1106.23 588.12 1105.85 587.984 1105.59 587.712C1105.35 587.44 1105.23 587.096 1105.23 586.68C1105.23 586.264 1105.35 585.92 1105.59 585.648C1105.85 585.376 1106.23 585.24 1106.75 585.24C1107.26 585.24 1107.63 585.376 1107.87 585.648C1108.13 585.92 1108.26 586.264 1108.26 586.68C1108.26 587.096 1108.13 587.44 1107.87 587.712C1107.63 587.984 1107.26 588.12 1106.75 588.12ZM1112.4 603V600.072H1115.18V603H1112.4ZM1124.16 603.432C1123.25 603.432 1122.41 603.264 1121.64 602.928C1120.87 602.592 1120.2 602.12 1119.63 601.512C1119.07 600.904 1118.63 600.2 1118.31 599.4C1118 598.6 1117.85 597.736 1117.85 596.808V596.376C1117.85 595.464 1118 594.608 1118.31 593.808C1118.61 593.008 1119.03 592.304 1119.58 591.696C1120.14 591.088 1120.79 590.616 1121.55 590.28C1122.31 589.928 1123.16 589.752 1124.09 589.752C1125.07 589.752 1125.95 589.96 1126.75 590.376C1127.55 590.776 1128.21 591.408 1128.72 592.272C1129.23 593.136 1129.52 594.256 1129.59 595.632L1128.63 594.096V585.48H1130.93V603H1129.11V597.312H1129.78C1129.71 598.768 1129.41 599.952 1128.87 600.864C1128.32 601.76 1127.63 602.416 1126.8 602.832C1125.99 603.232 1125.11 603.432 1124.16 603.432ZM1124.47 601.416C1125.26 601.416 1125.97 601.24 1126.61 600.888C1127.25 600.536 1127.76 600.032 1128.15 599.376C1128.53 598.704 1128.72 597.92 1128.72 597.024V595.92C1128.72 595.04 1128.52 594.296 1128.12 593.688C1127.74 593.064 1127.22 592.592 1126.56 592.272C1125.92 591.936 1125.22 591.768 1124.45 591.768C1123.6 591.768 1122.85 591.968 1122.19 592.368C1121.55 592.768 1121.05 593.328 1120.68 594.048C1120.33 594.768 1120.15 595.616 1120.15 596.592C1120.15 597.568 1120.34 598.424 1120.71 599.16C1121.07 599.88 1121.59 600.44 1122.24 600.84C1122.9 601.224 1123.64 601.416 1124.47 601.416ZM1140.8 603.432C1139.68 603.432 1138.72 603.24 1137.9 602.856C1137.08 602.472 1136.42 601.968 1135.91 601.344C1135.4 600.704 1135.01 599.992 1134.76 599.208C1134.52 598.424 1134.4 597.624 1134.4 596.808V596.376C1134.4 595.544 1134.52 594.736 1134.76 593.952C1135.01 593.168 1135.4 592.464 1135.91 591.84C1136.42 591.2 1137.07 590.696 1137.85 590.328C1138.65 589.944 1139.59 589.752 1140.66 589.752C1142.05 589.752 1143.2 590.056 1144.09 590.664C1145 591.256 1145.68 592.024 1146.11 592.968C1146.56 593.912 1146.78 594.92 1146.78 595.992V597.024H1135.4V595.296H1145.1L1144.57 596.232C1144.57 595.32 1144.43 594.536 1144.14 593.88C1143.85 593.208 1143.42 592.688 1142.84 592.32C1142.27 591.952 1141.54 591.768 1140.66 591.768C1139.75 591.768 1138.99 591.976 1138.38 592.392C1137.79 592.808 1137.34 593.376 1137.04 594.096C1136.75 594.816 1136.6 595.648 1136.6 596.592C1136.6 597.504 1136.75 598.328 1137.04 599.064C1137.34 599.784 1137.8 600.36 1138.43 600.792C1139.05 601.208 1139.84 601.416 1140.8 601.416C1141.81 601.416 1142.63 601.192 1143.25 600.744C1143.89 600.296 1144.28 599.776 1144.4 599.184H1146.56C1146.39 600.064 1146.04 600.824 1145.51 601.464C1144.98 602.104 1144.32 602.592 1143.52 602.928C1142.72 603.264 1141.81 603.432 1140.8 603.432ZM1152.69 603L1148.33 590.184H1150.73L1155 603H1152.69ZM1153.27 603V601.176H1156.05V603H1153.27ZM1154.37 603L1158.09 590.184H1160.35L1156.56 603H1154.37Z" fill="#C1B5E3"/>
</g>
<defs>
<clipPath id="clip0_1_2">
<rect width="1200" height="630" fill="white"/>
</clipPath>
</defs>
</svg>
<p style="position: absolute; top: 74px; left: 67px; max-width: 800px; color: #C1B5E3; font-size: 64px;">${title}</p>
</div>
`}

const dmSans = await readFile("./public/Sora.ttf")
export const buildOG = async (input: ReturnType<typeof html>) => {
	const svg = await satori(input, {
		width: 1200,
		height: 630,
		fonts: [
			{
				name: "Sora",
				data: dmSans,
				weight: 700,
				style: "normal",
			},
		],
	})
	const resvg = new Resvg(svg)
	return resvg.render().asPng()
}
